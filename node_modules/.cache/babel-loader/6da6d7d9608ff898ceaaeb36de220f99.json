{"ast":null,"code":"import _slicedToArray from \"C:\\\\Users\\\\PotapovDS\\\\AppData\\\\Roaming\\\\npm\\\\node_modules\\\\react-scripts\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/slicedToArray\";\nvar _jsxFileName = \"E:\\\\JS\\\\react_course\\\\4_connection\\\\src\\\\game.js\";\nimport React, { useState, useEffect } from 'react';\nimport './styles/App.css';\nimport Table from './components/table/table';\nimport { Redirect } from 'react-router-dom';\nimport axios from 'axios';\n\nfunction Game(props) {\n  //нужно убрать отсюда, но сделать обнуление состояния поля при старте игры\n  const START_GAME = [[0, 0, 0, 0, 0, 0], [0, 0, 0, 0, 0, 0], [0, 0, 0, 0, 0, 0], [0, 0, 0, 0, 0, 0], [0, 0, 0, 0, 0, 0], [0, 0, 0, 0, 0, 0], [0, 0, 0, 0, 0, 0]];\n  const player1Name = props.location.state.player1Name;\n  const player2Name = props.location.state.player2Name;\n\n  const _useState = useState(1),\n        _useState2 = _slicedToArray(_useState, 2),\n        currentPlayer = _useState2[0],\n        setCurrentPlayer = _useState2[1];\n\n  const _useState3 = useState(START_GAME),\n        _useState4 = _slicedToArray(_useState3, 2),\n        field = _useState4[0],\n        setField = _useState4[1];\n\n  const _useState5 = useState(false),\n        _useState6 = _slicedToArray(_useState5, 2),\n        isEndGame = _useState6[0],\n        setIsEndGame = _useState6[1];\n\n  useEffect(() => {\n    clearField();\n    const intervalID = setInterval(axios.get('http://localhost:4000/game/status').then(response => {\n      setField(response.data.field);\n      setCurrentPlayer(response.data.currentPlayer);\n    }).catch(error => console.log(error)), 2000);\n    return () => {\n      clearInterval(intervalID);\n    };\n  }, []);\n\n  function clearField() {\n    axios.patch('http://localhost:4000/game').then(res => {\n      console.log(res.data);\n      setField(res.data);\n      console.log('Поле очищено');\n    }).catch(error => {\n      console.log(error);\n    });\n  } //проверяем заполнен ли ряд, если да, ход не засчитывается, перехода хода нет\n\n\n  function checkFullColumn(arr) {\n    if (arr.indexOf(0) === -1) {\n      alert('этот ряд заполнен');\n      return true;\n    }\n  }\n\n  function noMoveAlert() {\n    alert('Больше нет ходов');\n    clearField();\n  } // сам ход\n\n\n  function move(columnId) {\n    columnId--;\n    let arr = field[columnId];\n    if (checkFullColumn(arr)) return;\n    let position = arr.indexOf(0); // здесь отправляем запрос на изменение состояния field на сервер\n\n    axios.post('http://localhost:4000/game', {\n      currentPlayer: currentPlayer,\n      column: columnId,\n      raw: position,\n      isEndGame: isEndGame\n    }).then(res => {\n      let newField = res.data.field;\n\n      if (newField === 'noMove') {\n        noMoveAlert();\n      } else {\n        setField(res.data.field);\n      }\n\n      setCurrentPlayer(res.data.currentPlayer);\n      setIsEndGame(res.data.isEndGame);\n    }).catch(error => {\n      console.log(error);\n    });\n  } // проверка введено ли что-то в поля имен, можно добавить проверку по каждому из полей,\n  // если проверка не прошла возвра на стартовую сраницу\n\n\n  if (!props.location.state.player1Name || !props.location.state.player2Name) {\n    alert('Введите имя игрока');\n    return React.createElement(Redirect, {\n      to: \"/\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 106\n      },\n      __self: this\n    });\n  } // если игра закончилась, направляем на конечный экран, передаем имена игроков и номер игрока-победиеля\n\n\n  if (isEndGame === true) {\n    return React.createElement(Redirect, {\n      to: {\n        pathname: '/endGame',\n        state: {\n          currentPlayer: currentPlayer,\n          player1Name: player1Name,\n          player2Name: player2Name\n        }\n      },\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 112\n      },\n      __self: this\n    });\n  }\n\n  return React.createElement(\"div\", {\n    className: \"App\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 126\n    },\n    __self: this\n  }, React.createElement(\"p\", {\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 127\n    },\n    __self: this\n  }, player1Name), \"vs\", React.createElement(\"p\", {\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 129\n    },\n    __self: this\n  }, player2Name), React.createElement(Table, {\n    onColumnPress: move,\n    currentPlayer: currentPlayer,\n    player1Name: player1Name,\n    player2Name: player2Name,\n    field: field,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 130\n    },\n    __self: this\n  }));\n}\n\nexport default Game;","map":{"version":3,"sources":["E:/JS/react_course/4_connection/src/game.js"],"names":["React","useState","useEffect","Table","Redirect","axios","Game","props","START_GAME","player1Name","location","state","player2Name","currentPlayer","setCurrentPlayer","field","setField","isEndGame","setIsEndGame","clearField","intervalID","setInterval","get","then","response","data","catch","error","console","log","clearInterval","patch","res","checkFullColumn","arr","indexOf","alert","noMoveAlert","move","columnId","position","post","column","raw","newField","pathname"],"mappings":"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","sourcesContent":["import React, {useState, useEffect} from 'react';\r\nimport './styles/App.css';\r\nimport Table from './components/table/table';\r\nimport {Redirect} from 'react-router-dom';\r\nimport axios from 'axios';\r\n\r\nfunction Game(props) {\r\n\r\n//нужно убрать отсюда, но сделать обнуление состояния поля при старте игры\r\n  const START_GAME = [\r\n    [0, 0, 0, 0, 0, 0],\r\n    [0, 0, 0, 0, 0, 0],\r\n    [0, 0, 0, 0, 0, 0],\r\n    [0, 0, 0, 0, 0, 0],\r\n    [0, 0, 0, 0, 0, 0],\r\n    [0, 0, 0, 0, 0, 0],\r\n    [0, 0, 0, 0, 0, 0],\r\n  ]\r\n\r\n  const player1Name = props.location.state.player1Name;\r\n  const player2Name = props.location.state.player2Name;\r\n\r\n  const [currentPlayer, setCurrentPlayer] = useState(1);\r\n  const [field, setField] = useState(START_GAME);\r\n  const [isEndGame, setIsEndGame] = useState(false);\r\n\r\n  useEffect(() => {\r\n     clearField();\r\n      const intervalID = setInterval(\r\n        axios.get('http://localhost:4000/game/status')\r\n        .then((response) => {\r\n          setField(response.data.field);\r\n          setCurrentPlayer(response.data.currentPlayer);\r\n        })\r\n        .catch((error) => console.log(error)),\r\n        2000\r\n      );\r\n      return () => {\r\n        clearInterval(intervalID);\r\n      }\r\n    },\r\n    []\r\n  );\r\n\r\n  function clearField(){\r\n     axios\r\n      .patch(\r\n         'http://localhost:4000/game'\r\n      )\r\n      .then((res)=> {\r\n         console.log(res.data);\r\n         setField(res.data);\r\n\r\n         console.log('Поле очищено')\r\n      })\r\n      .catch((error)=> {\r\n          console.log(error);\r\n      });\r\n  }\r\n\r\n  //проверяем заполнен ли ряд, если да, ход не засчитывается, перехода хода нет\r\n  function checkFullColumn(arr) {\r\n    if (arr.indexOf(0) === -1) {\r\n      alert('этот ряд заполнен');\r\n      return true;\r\n    }\r\n  }\r\n\r\n  function noMoveAlert(){\r\n     alert('Больше нет ходов');\r\n     clearField();\r\n }\r\n\r\n  // сам ход\r\n  function move(columnId) {\r\n    columnId--;\r\n    let arr = field[columnId];\r\n    if (checkFullColumn(arr)) return;\r\n    let position = arr.indexOf(0);\r\n\r\n// здесь отправляем запрос на изменение состояния field на сервер\r\n    axios\r\n      .post(\r\n        'http://localhost:4000/game',\r\n        {currentPlayer: currentPlayer, column: columnId, raw: position, isEndGame: isEndGame }\r\n      )\r\n      .then((res)=> {\r\n         let newField = res.data.field;\r\n         if (newField === 'noMove'){\r\n            noMoveAlert();\r\n         } else {\r\n            setField(res.data.field);\r\n         }\r\n         setCurrentPlayer(res.data.currentPlayer);\r\n         setIsEndGame(res.data.isEndGame);\r\n      })\r\n      .catch((error)=> {\r\n         console.log(error);\r\n      });\r\n  }\r\n\r\n  // проверка введено ли что-то в поля имен, можно добавить проверку по каждому из полей,\r\n  // если проверка не прошла возвра на стартовую сраницу\r\n  if (!props.location.state.player1Name || !props.location.state.player2Name) {\r\n    alert('Введите имя игрока');\r\n    return <Redirect to=\"/\" / >\r\n  }\r\n\r\n\r\n  // если игра закончилась, направляем на конечный экран, передаем имена игроков и номер игрока-победиеля\r\n  if (isEndGame === true) {\r\n    return <Redirect to={\r\n      {\r\n        pathname: '/endGame',\r\n        state: {\r\n          currentPlayer: currentPlayer,\r\n          player1Name: player1Name,\r\n          player2Name: player2Name\r\n        }\r\n      }\r\n    }\r\n    />\r\n  }\r\n\r\n  return (\r\n    <div className=\"App\">\r\n      <p>{player1Name}</p>\r\n      vs\r\n      <p>{player2Name}</p>\r\n      <Table onColumnPress={move}\r\n             currentPlayer={currentPlayer}\r\n             player1Name={player1Name}\r\n             player2Name={player2Name}\r\n             field={field}\r\n      />\r\n    </div>\r\n  );\r\n}\r\n\r\nexport default Game;\r\n"]},"metadata":{},"sourceType":"module"}